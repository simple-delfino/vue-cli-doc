(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{436:function(e,t,v){"use strict";v.r(t);var _=v(46),s=Object(_.a)({},(function(){var e=this,t=e.$createElement,v=e._self._c||t;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("h1",{attrs:{id:"режимы-работы-и-переменные-окружения"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#режимы-работы-и-переменные-окружения"}},[e._v("#")]),e._v(" Режимы работы и переменные окружения")]),e._v(" "),v("h2",{attrs:{id:"режимы-работы"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#режимы-работы"}},[e._v("#")]),e._v(" Режимы работы")]),e._v(" "),v("p",[v("strong",[e._v("Режимы работы")]),e._v(" — важная часть проектов Vue CLI. По умолчанию есть три режима работы:")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("development")]),e._v(" используется "),v("code",[e._v("vue-cli-service serve")])]),e._v(" "),v("li",[v("code",[e._v("test")]),e._v(" используется "),v("code",[e._v("vue-cli-service test:unit")])]),e._v(" "),v("li",[v("code",[e._v("production")]),e._v(" используется "),v("code",[e._v("vue-cli-service build")]),e._v(" и "),v("code",[e._v("vue-cli-service test:e2e")])])]),e._v(" "),v("p",[e._v("Можно переопределять используемый для команды режим по умолчанию опцией "),v("code",[e._v("--mode")]),e._v(". Например, если необходимо использовать переменные для разработки в команде сборки:")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("vue-cli-service build --mode development\n")])])]),v("p",[e._v("При запуске "),v("code",[e._v("vue-cli-service")]),e._v(" загрузит переменные окружения из всех "),v("a",{attrs:{href:"#%D0%BF%D0%B5%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BE%D0%BA%D1%80%D1%83%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F"}},[e._v("соответствующих файлов")]),e._v(". Если в них не указана переменная "),v("code",[e._v("NODE_ENV")]),e._v(", то она установится соответствующим образом. Например, "),v("code",[e._v("NODE_ENV")]),e._v(" будет установлена в "),v("code",[e._v('"production"')]),e._v(" в режиме production, "),v("code",[e._v('"test"')]),e._v(" в режиме test, а по умолчанию "),v("code",[e._v('"development"')]),e._v(" в противном случае.")]),e._v(" "),v("p",[e._v("Затем "),v("code",[e._v("NODE_ENV")]),e._v(" определяет основной режим работы приложения — разработка, production или тестирование — и, следовательно, какую конфигурацию webpack требуется создавать.")]),e._v(" "),v("p",[e._v("Например, для "),v("code",[e._v("NODE_ENV=test")]),e._v(" Vue CLI создаёт конфигурацию webpack, которая оптимизирована и предназначена для модульных тестов. В ней не обрабатываются изображения и другие ресурсы, которые не требуются для модульных тестов.")]),e._v(" "),v("p",[e._v("Аналогично, при "),v("code",[e._v("NODE_ENV=development")]),e._v(" создаётся конфигурация webpack, которая включает горячую перезагрузку модулей (HMR), не добавляет хэши в имена файлов ресурсов и не создаёт сборку для вендоров, чтобы обеспечить быструю пересборку при запуске сервера разработки.")]),e._v(" "),v("p",[e._v("При запуске "),v("code",[e._v("vue-cli-service build")]),e._v(", значение всегда должно быть "),v("code",[e._v("NODE_ENV=production")]),e._v(" для получения приложения готового к публикации, независимо от окружения куда будет осуществляться публиковаться.")]),e._v(" "),v("div",{staticClass:"custom-block warning"},[v("p",{staticClass:"custom-block-title"},[e._v("Предупреждение об использовании NODE_ENV")]),e._v(" "),v("p",[e._v("Если в вашем окружении по умолчанию установлен "),v("code",[e._v("NODE_ENV")]),e._v(", необходимо либо удалить его, либо явно установить "),v("code",[e._v("NODE_ENV")]),e._v(" при запуске команд "),v("code",[e._v("vue-cli-service")]),e._v(".")])]),e._v(" "),v("h2",{attrs:{id:"переменные-окружения"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#переменные-окружения"}},[e._v("#")]),e._v(" Переменные окружения")]),e._v(" "),v("p",[e._v("Переменные окружения можно указать в специальных файлах в корне проекта:")]),e._v(" "),v("div",{staticClass:"language-bash extra-class"},[v("pre",{pre:!0,attrs:{class:"language-bash"}},[v("code",[e._v(".env                "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# загружается во всех случаях")]),e._v("\n.env.local          "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# загружается во всех случаях, игнорируется git")]),e._v("\n.env."),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("mode"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("         "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# загружается только в указанном режиме работы")]),e._v("\n.env."),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("mode"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(".local   "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# загружается только в указанном режиме работы, игнорируется git")]),e._v("\n")])])]),v("p",[e._v("Такой "),v("code",[e._v(".env")]),e._v(" файл просто содержит пары ключ=значение требуемых переменных окружения:")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("FOO=bar\nVUE_APP_SECRET=secret\n")])])]),v("p",[e._v("Обратите внимание, что только переменные с префиксом "),v("code",[e._v("VUE_APP_")]),e._v(" будут статически внедряться в клиентскую сборку с помощью "),v("code",[e._v("webpack.DefinePlugin")]),e._v(".")]),e._v(" "),v("p",[e._v("Подробнее о правилах парсинга env можно узнать "),v("a",{attrs:{href:"https://github.com/motdotla/dotenv#rules",target:"_blank",rel:"noopener noreferrer"}},[e._v("в документации "),v("code",[e._v("dotenv")]),v("OutboundLink")],1),e._v(". Мы также используем "),v("a",{attrs:{href:"https://github.com/motdotla/dotenv-expand",target:"_blank",rel:"noopener noreferrer"}},[e._v("dotenv-expand"),v("OutboundLink")],1),e._v(" для переменных расширения (доступно в Vue CLI 3.5+).")]),e._v(" "),v("p",[e._v("Загруженные переменные станут доступны всем командам "),v("code",[e._v("vue-cli-service")]),e._v(", плагинам и зависимостям.")]),e._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[e._v("Приоритет загрузки переменных окружения")]),e._v(" "),v("p",[e._v("Файл с переменными для определённого режима работы (например, "),v("code",[e._v(".env.production")]),e._v(") имеет более высокий приоритет, чем общий файл (например, "),v("code",[e._v(".env")]),e._v(").")]),e._v(" "),v("p",[e._v("Кроме того, переменные окружения, которые уже существуют при запуске Vue CLI имеют наивысший приоритет и не будут перезаписаны значениями из файлов "),v("code",[e._v(".env")]),e._v(".")]),e._v(" "),v("p",[e._v("Файлы "),v("code",[e._v(".env")]),e._v(" загружаются при запуске "),v("code",[e._v("vue-cli-service")]),e._v(". При внесении изменений в файлы необходимо перезапустить службу.")])]),e._v(" "),v("h3",{attrs:{id:"пример-режим-staging"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#пример-режим-staging"}},[e._v("#")]),e._v(" Пример: режим Staging")]),e._v(" "),v("p",[e._v("Предположим, что у нас есть приложение с "),v("code",[e._v(".env")]),e._v(" файлом:")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("VUE_APP_TITLE=My App\n")])])]),v("p",[e._v("И следующий "),v("code",[e._v(".env.staging")]),e._v(" файл:")]),e._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[e._v("NODE_ENV=production\nVUE_APP_TITLE=My App (staging)\n")])])]),v("ul",[v("li",[v("p",[v("code",[e._v("vue-cli-service build")]),e._v(" собирает приложение для production, загружает "),v("code",[e._v(".env")]),e._v(", "),v("code",[e._v(".env.production")]),e._v(" и "),v("code",[e._v(".env.production.local")]),e._v(" если они существуют;")])]),e._v(" "),v("li",[v("p",[v("code",[e._v("vue-cli-service build --mode staging")]),e._v(" собирает приложение для production в режиме staging, используя "),v("code",[e._v(".env")]),e._v(", "),v("code",[e._v(".env.staging")]),e._v(" и "),v("code",[e._v(".env.staging.local")]),e._v(" если они существуют.")])])]),e._v(" "),v("p",[e._v("В обоих случаях приложение собирается для production из-за установленного "),v("code",[e._v("NODE_ENV")]),e._v(", но в режиме staging, "),v("code",[e._v("process.env.VUE_APP_TITLE")]),e._v(" будет перезаписываться другим значением.")]),e._v(" "),v("h3",{attrs:{id:"испоnьзование-переменных-окружения-в-кnиентском-коде"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#испоnьзование-переменных-окружения-в-кnиентском-коде"}},[e._v("#")]),e._v(" Использование переменных окружения в клиентском коде")]),e._v(" "),v("p",[e._v("Можно получить доступ к переменным окружения из кода приложения:")]),e._v(" "),v("div",{staticClass:"language-js extra-class"},[v("pre",{pre:!0,attrs:{class:"language-js"}},[v("code",[e._v("console"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("process"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),v("span",{pre:!0,attrs:{class:"token constant"}},[e._v("VUE_APP_SECRET")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),v("p",[e._v("На этапе сборки "),v("code",[e._v("process.env.VUE_APP_SECRET")]),e._v(" будет заменяться соответствующим значением. Когда в файле указано "),v("code",[e._v("VUE_APP_SECRET=secret")]),e._v(" — после сборки значением будет "),v("code",[e._v('"secret"')]),e._v(".")]),e._v(" "),v("p",[e._v("В дополнение к переменным "),v("code",[e._v("VUE_APP_*")]),e._v(" есть также две специальные переменные, которые всегда доступны в коде приложения:")]),e._v(" "),v("ul",[v("li",[v("code",[e._v("NODE_ENV")]),e._v(" — значение будет "),v("code",[e._v('"development"')]),e._v(", "),v("code",[e._v('"production"')]),e._v(" или "),v("code",[e._v('"test"')]),e._v(" в зависимости от "),v("a",{attrs:{href:"#%D1%80%D0%B5%D0%B6%D0%B8%D0%BC%D1%8B-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B"}},[e._v("режима работы")]),e._v(" в котором работает приложение.")]),e._v(" "),v("li",[v("code",[e._v("BASE_URL")]),e._v(" — соответствует опции "),v("code",[e._v("publicPath")]),e._v(" в "),v("code",[e._v("vue.config.js")]),e._v(" и определяет базовый путь по которому опубликовано ваше приложение.")])]),e._v(" "),v("p",[e._v("Все разрешённые переменные окружения также будут доступны внутри "),v("code",[e._v("public/index.html")]),e._v(" как обсуждалось ранее в разделе "),v("RouterLink",{attrs:{to:"/ru/guide/html-and-static-assets.html#интерпоnяции"}},[e._v("HTML - Интерполяции")]),e._v(".")],1),e._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[e._v("Совет")]),e._v(" "),v("p",[e._v("Можно добавлять вычисляемые переменные окружения в "),v("code",[e._v("vue.config.js")]),e._v(". Они по-прежнему должны именоваться с префикса "),v("code",[e._v("VUE_APP_")]),e._v(". Может пригодиться для получения информации о версии")]),e._v(" "),v("div",{staticClass:"language-js extra-class"},[v("pre",{pre:!0,attrs:{class:"language-js"}},[v("code",[e._v("process"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),v("span",{pre:!0,attrs:{class:"token constant"}},[e._v("VUE_APP_VERSION")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[e._v("require")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),v("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./package.json'")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("version\n\nmodule"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),v("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),v("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// конфигурация")]),e._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])])]),e._v(" "),v("h3",{attrs:{id:"переменные-тоnько-дnя-nокаnьного-окружения"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#переменные-тоnько-дnя-nокаnьного-окружения"}},[e._v("#")]),e._v(" Переменные только для локального окружения")]),e._v(" "),v("p",[e._v("Иногда необходимы переменные окружения, которые не должны быть привязаны к кодовой базе, особенно если проект размещается в публичном репозитории. В таком случае следует использовать файл "),v("code",[e._v(".env.local")]),e._v(". Локальные env-файлы добавлены в "),v("code",[e._v(".gitignore")]),e._v(" по умолчанию.")]),e._v(" "),v("p",[v("code",[e._v(".local")]),e._v(" также могут добавляться к env-файлам специфичным для режима работы, например "),v("code",[e._v(".env.development.local")]),e._v(" будет загружен во время разработки, и будет игнорироваться git.")])])}),[],!1,null,null,null);t.default=s.exports}}]);