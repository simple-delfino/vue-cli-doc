(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{427:function(e,t,s){"use strict";s.r(t);var r=s(46),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"совместимость-с-браузерами"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#совместимость-с-браузерами"}},[e._v("#")]),e._v(" Совместимость с браузерами")]),e._v(" "),s("h2",{attrs:{id:"browserslist"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#browserslist"}},[e._v("#")]),e._v(" browserslist")]),e._v(" "),s("p",[e._v("Вы заметите поле "),s("code",[e._v("browserslist")]),e._v(" в файле "),s("code",[e._v("package.json")]),e._v(" (или файл "),s("code",[e._v(".browserslistrc")]),e._v("), где определяется диапазон браузеров под которые разрабатывается проект. Эти значения будут использоваться в "),s("a",{attrs:{href:"https://new.babeljs.io/docs/en/next/babel-preset-env.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("@babel/preset-env"),s("OutboundLink")],1),e._v(" и "),s("a",{attrs:{href:"https://github.com/postcss/autoprefixer",target:"_blank",rel:"noopener noreferrer"}},[e._v("autoprefixer"),s("OutboundLink")],1),e._v(" для автоматического определения возможностей JavaScript, которые требуется транспилировать, а также необходимые префиксные правила CSS.")]),e._v(" "),s("p",[e._v("Как указывается диапазон браузеров, можно узнать "),s("a",{attrs:{href:"https://github.com/ai/browserslist",target:"_blank",rel:"noopener noreferrer"}},[e._v("здесь"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"поnифиnы"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#поnифиnы"}},[e._v("#")]),e._v(" Полифилы")]),e._v(" "),s("p",[e._v("По умолчанию проект Vue CLI использует "),s("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/babel-preset-app",target:"_blank",rel:"noopener noreferrer"}},[e._v("@vue/babel-preset-app"),s("OutboundLink")],1),e._v(", в котором используется "),s("code",[e._v("@babel/preset-env")]),e._v(" и конфигурация "),s("code",[e._v("browserslist")]),e._v(" для определения необходимых полифилов.")]),e._v(" "),s("h3",{attrs:{id:"usebuiltins-usage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#usebuiltins-usage"}},[e._v("#")]),e._v(" useBuiltIns: 'usage'")]),e._v(" "),s("p",[e._v("По умолчанию в "),s("code",[e._v("@babel/preset-env")]),e._v(" будет передаваться "),s("a",{attrs:{href:"https://new.babeljs.io/docs/en/next/babel-preset-env.html#usebuiltins-usage",target:"_blank",rel:"noopener noreferrer"}},[s("code",[e._v("useBuiltIns: 'usage'")]),s("OutboundLink")],1),e._v(" для автоматического определения необходимых полифилов, основываясь на том, какие возможности языка были использованы в исходном коде проекта. Это гарантирует, что в финальную сборку попадёт только минимально необходимое количество полифилов. Однако это также означает, что "),s("strong",[e._v("если одна из ваших зависимостей имеет специфичные требования к полифилам, то по умолчанию Babel не сможет это определить.")])]),e._v(" "),s("p",[e._v("Если одной из ваших зависимостей требуются полифилы, у вас есть несколько вариантов:")]),e._v(" "),s("ol",[s("li",[s("p",[s("strong",[e._v("Если зависимость написана в версии ES, которую не поддерживают целевые окружения:")]),e._v(" Добавьте эту зависимость в опцию "),s("RouterLink",{attrs:{to:"/ru/config/#transpiledependencies"}},[s("code",[e._v("transpileDependencies")])]),e._v(" в файле "),s("code",[e._v("vue.config.js")]),e._v(". Это позволит использовать как синтаксические преобразования, так и определение полифилов для используемых возможностей для этой зависимости.")],1)]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Если зависимость предоставляет ES5 код и явно перечисляет необходимые полифилы:")]),e._v(" вы можете предварительно включить необходимые полифилы с помощью опции "),s("a",{attrs:{href:"https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/babel-preset-app#polyfills",target:"_blank",rel:"noopener noreferrer"}},[e._v("polyfills"),s("OutboundLink")],1),e._v(" для "),s("code",[e._v("@vue/babel-preset-app")]),e._v(". "),s("strong",[e._v("Обратите внимание, что "),s("code",[e._v("es.promise")]),e._v(" добавлен по умолчанию, так как он  часто необходим для библиотек, основанных на Promise.")])]),e._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// babel.config.js")]),e._v("\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  presets"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'@vue/app'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      polyfills"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'es.promise'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v("'es.symbol'")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Совет")]),e._v(" "),s("p",[e._v("Рекомендуется добавлять полифилы таким образом, а не напрямую импортировать их в коде, потому что полифилы перечисленные здесь, могут быть автоматически исключены, если целевым браузерам, указанным в "),s("code",[e._v("browserslist")]),e._v(", они не нужны.")])])]),e._v(" "),s("li",[s("p",[s("strong",[e._v("Если зависимость предоставляет ES5 код, но использует возможности ES6+ без явного перечисления необходимых полифилов (например, Vuetify):")]),e._v(" Используйте "),s("code",[e._v("useBuiltIns: 'entry'")]),e._v(" и затем добавьте "),s("code",[e._v("import 'core-js/stable'; import 'regenerator-runtime/runtime';")]),e._v(" в файл точки входа. Это будет импортировать "),s("strong",[e._v("ВСЕ")]),e._v(" полифилы на основе целей, перечисленных в "),s("code",[e._v("browserslist")]),e._v(", так что вам больше не нужно будет беспокоиться о полифилах для зависимостей, но это скорее всего увеличит размер финальной сборки некоторыми неиспользуемыми полифилами.")])])]),e._v(" "),s("p",[e._v("Подробнее можно изучить в "),s("a",{attrs:{href:"https://new.babeljs.io/docs/en/next/babel-preset-env.html#usebuiltins-usage",target:"_blank",rel:"noopener noreferrer"}},[e._v("документации @babel/preset-env"),s("OutboundLink")],1),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"поnифиnы-при-сборке-бибnиотеки-иnи-веб-компонентов"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#поnифиnы-при-сборке-бибnиотеки-иnи-веб-компонентов"}},[e._v("#")]),e._v(" Полифилы при сборке библиотеки или веб-компонентов")]),e._v(" "),s("p",[e._v("При использовании Vue CLI для "),s("RouterLink",{attrs:{to:"/ru/guide/build-targets.html"}},[e._v("сборки библиотеки или веб-компонентов")]),e._v(" рекомендуется указывать "),s("code",[e._v("useBuiltIns: false")]),e._v(" для "),s("code",[e._v("@vue/babel-preset-app")]),e._v(", чтобы отключить автоматическое добавление полифилов. Это гарантирует, что вы не добавляете ненужные полифилы в свой код, потому что полифилами должно будет заниматься приложение, где они будут использоваться.")],1),e._v(" "),s("h2",{attrs:{id:"современный-режим"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#современный-режим"}},[e._v("#")]),e._v(" Современный режим")]),e._v(" "),s("p",[e._v("Благодаря Babel мы можем использовать все новейшие возможности языка ES2015+, но это также означает, что нам необходимо предоставлять транспилированную сборку с полифилами для поддержки старых браузеров. Эти транспилированные сборки зачастую больше в размере, чем оригинальный исходный код в ES2015+, а их парсинг и выполнение происходит медленнее. Учитывая, что сегодня у большинства современных браузеров есть прекрасная поддержка ES2015, становится пустой тратой необходимость предоставлять более тяжёлый и менее эффективный код для них лишь потому, что мы должны поддерживать старые версии браузеров.")]),e._v(" "),s("p",[e._v("Vue CLI предоставляет «Современный режим», чтобы помочь в решении этой проблемы. При сборке для production с помощью следующей команды:")]),e._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[e._v("vue-cli-service build --modern\n")])])]),s("p",[e._v("Vue CLI будет собирать "),s("strong",[e._v("две версии")]),e._v(" вашего приложения: первая сборка для современных браузеров, которые поддерживают "),s("a",{attrs:{href:"https://jakearchibald.com/2017/es-modules-in-browsers/",target:"_blank",rel:"noopener noreferrer"}},[e._v("ES-модули"),s("OutboundLink")],1),e._v(", а вторая сборка для старых браузеров, которые не имеют такой поддержки.")]),e._v(" "),s("p",[e._v("Приятная часть заключается в том, что ничего специально делать при публикации не требуется. Сгенерированный HTML-файл автоматически использует технику, описанную в классном "),s("a",{attrs:{href:"https://philipwalton.com/articles/deploying-es2015-code-in-production-today/",target:"_blank",rel:"noopener noreferrer"}},[e._v("посте Филлипа Уолтона"),s("OutboundLink")],1),e._v(":")]),e._v(" "),s("ul",[s("li",[s("p",[e._v("Современная сборка загружается с помощью "),s("code",[e._v('<script type="module">')]),e._v(" в браузерах, которые поддерживают модули; они также предзагружаются через "),s("code",[e._v('<link rel="modulepreload">')]),e._v(".")])]),e._v(" "),s("li",[s("p",[e._v("Сборка для старых браузеров загружается с помощью тега "),s("code",[e._v("<script nomodule>")]),e._v(", который игнорируется браузерами, поддерживающими ES-модули.")])]),e._v(" "),s("li",[s("p",[e._v("Исправление ошибки для "),s("code",[e._v("<script nomodule>")]),e._v(" в Safari 10 также внедряется автоматически.")])])]),e._v(" "),s("p",[e._v("Для приложения Hello World современная сборка на 16% меньше. В production использование современной сборки приводит к значительному ускорению парсинга и исполнения кода, что повышает производительность загрузки приложения.")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Совет")]),e._v(" "),s("p",[s("code",[e._v('<script type="module">')]),e._v(" загружаются "),s("a",{attrs:{href:"https://jakearchibald.com/2017/es-modules-in-browsers/#always-cors",target:"_blank",rel:"noopener noreferrer"}},[e._v("всегда с помощью CORS"),s("OutboundLink")],1),e._v(". Это значит, что ваш сервер должен возвращать корректные заголовки CORS, такие как "),s("code",[e._v("Access-Control-Allow-Origin: *")]),e._v(". Если вы хотите загружать скрипты с помощью credentials, установите опцию "),s("RouterLink",{attrs:{to:"/ru/config/#crossorigin"}},[e._v("crossorigin")]),e._v(" в значение "),s("code",[e._v("use-credentials")]),e._v(".")],1),e._v(" "),s("p",[e._v("Кроме того, современный режим использует инлайновый скрипт для избежания загрузки обеих сборок в Safari 10, поэтому, если вы используете строгие политики CSP, необходимо явно разрешить инлайновый скрипт с помощью:")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Content-Security-Policy: script-src 'self' 'sha256-4RS22DYeB7U14dra4KcQYxmwt5HkOInieXK1NUMBmQI='\n")])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Определение текущего режима в конфигурации")]),e._v(" "),s("p",[e._v("Иногда может потребоваться изменить конфигурацию webpack только сборки для старых браузеров или только сборки для современных браузеров.")]),e._v(" "),s("p",[e._v("Vue CLI использует две переменных окружения для определения этого:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("VUE_CLI_MODERN_MODE")]),e._v(": флаг, что сборка была запущена с флагом "),s("code",[e._v("--modern")])]),e._v(" "),s("li",[s("code",[e._v("VUE_CLI_MODERN_BUILD")]),e._v(": значение true будет, если текущая конфигурация для современной сборки. В противном случае это сборка для старых браузеров.")])]),e._v(" "),s("p",[s("strong",[e._v("Важно:")]),e._v(" Переменные доступны только при вызове/после вызова функций "),s("code",[e._v("chainWebpack()")]),e._v(" и "),s("code",[e._v("configureWebpack()")]),e._v(", (т.е. не напрямую в области видимости модуля "),s("code",[e._v("vue.config.js")]),e._v("). Это также означает, что они доступны в файле конфигурации postcss.")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("Предостережение: Настройка плагинов webpack")]),e._v(" "),s("p",[e._v("Некоторые плагины, такие как "),s("code",[e._v("html-webpack-plugin")]),e._v(", "),s("code",[e._v("preload-plugin")]),e._v(" и т.п., добавляются только в конфигурации для современного режима. Попытка использовать их опции в конфигурации для старых браузеров может привести к ошибке, так как этих плагинов не будет существовать.")]),e._v(" "),s("p",[e._v("Используйте совет выше об "),s("em",[e._v("Определении текущего режима в конфигурации")]),e._v(" для управления плагинами только в соответствующем режиме, и/или проверяйте наличие плагина в конфигурации текущего режима, прежде чем использовать их опции.")])])])}),[],!1,null,null,null);t.default=a.exports}}]);