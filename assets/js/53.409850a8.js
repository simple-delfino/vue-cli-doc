(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{419:function(s,t,e){"use strict";e.r(t);var a=e(46),v=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"vue-cli-plugin-unit-jest"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue-cli-plugin-unit-jest"}},[s._v("#")]),s._v(" @vue/cli-plugin-unit-jest")]),s._v(" "),e("blockquote",[e("p",[s._v("Плагин unit-jest для vue-cli")])]),s._v(" "),e("h2",{attrs:{id:"внедряемые-команды"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#внедряемые-команды"}},[s._v("#")]),s._v(" Внедряемые команды")]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("code",[s._v("vue-cli-service test:unit")])])]),s._v(" "),e("p",[s._v("Запуск модульных тестов с помощью Jest. По умолчанию значением "),e("code",[s._v("testMatch")]),s._v(" будет "),e("code",[s._v("<rootDir>/(tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx))")]),s._v(" что совпадает с:")]),s._v(" "),e("ul",[e("li",[s._v("Любыми файлами в "),e("code",[s._v("tests/unit")]),s._v(" которые заканчиваются на "),e("code",[s._v(".spec.(js|jsx|ts|tsx)")]),s._v(";")]),s._v(" "),e("li",[s._v("Любыми js(x)/ts(x) файлами внутри каталогов "),e("code",[s._v("__tests__")]),s._v(".")])]),s._v(" "),e("p",[s._v("Использование: "),e("code",[s._v("vue-cli-service test:unit [options] <regexForTestFiles>")])]),s._v(" "),e("p",[s._v("Также поддерживаются все "),e("a",{attrs:{href:"https://facebook.github.io/jest/docs/en/cli.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("опции Jest CLI"),e("OutboundLink")],1),s._v(".")])])]),s._v(" "),e("h2",{attrs:{id:"отnадка-тестов"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#отnадка-тестов"}},[s._v("#")]),s._v(" Отладка тестов")]),s._v(" "),e("p",[s._v("Обратите внимание, что запуск "),e("code",[s._v("jest")]),s._v(" напрямую будет заканчиваться ошибкой, потому что для пресета Babel требуются подсказки как заставить код работать в Node.js. Поэтому необходимо запускать тесты командой "),e("code",[s._v("vue-cli-service test:unit")]),s._v(".")]),s._v(" "),e("p",[s._v("Если необходимо отладить тесты с помощью инспектора Node, можно запустить следующее:")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# macOS или linux")]),s._v("\nnode --inspect-brk ./node_modules/.bin/vue-cli-service test:unit\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Windows")]),s._v("\nnode --inspect-brk ./node_modules/@vue/cli-service/bin/vue-cli-service.js test:unit\n")])])]),e("h2",{attrs:{id:"конфигурация"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#конфигурация"}},[s._v("#")]),s._v(" Конфигурация")]),s._v(" "),e("p",[s._v("Jest можно настроить через "),e("code",[s._v("jest.config.js")]),s._v(" в корне проекта, или через поле "),e("code",[s._v("jest")]),s._v(" в файле "),e("code",[s._v("package.json")]),s._v(".")]),s._v(" "),e("h2",{attrs:{id:"установка-в-уже-созданный-проект"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#установка-в-уже-созданный-проект"}},[s._v("#")]),s._v(" Установка в уже созданный проект")]),s._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("vue "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" unit-jest\n")])])]),e("h2",{attrs:{id:"обработка-зависимостей-из-node-modules"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#обработка-зависимостей-из-node-modules"}},[s._v("#")]),s._v(" Обработка зависимостей из "),e("code",[s._v("/node_modules")])]),s._v(" "),e("p",[s._v("По умолчанию jest не обрабатывает ничего из "),e("code",[s._v("/node_modules")]),s._v(".")]),s._v(" "),e("p",[s._v("Поскольку jest работает на Node, то нет необходимости транспилировать всё, где используются современные возможности ECMAScript, так как Node >=8 уже их поддерживает, поэтому это разумное решение по умолчанию. По этой же причине также cli-plugin-jest не поддерживает опцию "),e("code",[s._v("transpileDependencies")]),s._v(" в файле "),e("code",[s._v("vue.config.js")]),s._v(".")]),s._v(" "),e("p",[s._v("Однако, есть (по крайней мере) три случая, когда необходимо транспилировать код из "),e("code",[s._v("/node_modules")]),s._v(" в jest:")]),s._v(" "),e("ol",[e("li",[s._v("Использование выражений ES6 "),e("code",[s._v("import")]),s._v("/"),e("code",[s._v("export")]),s._v(", которые нужно скомпилировать в формат commonjs "),e("code",[s._v("module.exports")])]),s._v(" "),e("li",[s._v("Однофайловые компоненты ("),e("code",[s._v(".vue")]),s._v(" файлы) которые запускаются через "),e("code",[s._v("vue-jest")])]),s._v(" "),e("li",[s._v("Код Typescript")])]),s._v(" "),e("p",[s._v("Для этого необходимо добавить исключение в опции jest "),e("code",[s._v("transformIgnorePatterns")]),s._v(". Значение по умолчанию такое:")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("transformIgnorePatterns"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/node_modules/'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("Необходимо добавить исключения из этого шаблона с негативным lookahead в RegExp:")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("transformIgnorePatterns"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/node_modules/(?!name-of-lib-o-transform)'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[s._v("Для исключения нескольких библиотек:")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[s._v("transformIgnorePatterns"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/node_modules/(?!lib-to-transform|other-lib)'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=v.exports}}]);